// Generated by CoffeeScript 1.6.2
(function() {
  var CM;

  CM = angular.module('ChatModule', []);

  CM.controller('ChatCtrl', function($scope) {
    $scope.public_msg = [];
    $scope.reserved_username = ['system'];
    return $scope.register = function() {
      var socket;

      if (_.contains($scope.reserved_username, $scope.name.toLowerCase())) {
        return $scope.failed_msg = "Hmmm, reserved username cant be used";
      } else {
        socket = io.connect("" + location.protocol + "//" + location.host);
        socket.on('init_chatters', function(members) {
          $scope.chatters = members;
          $scope.open_msg_box = true;
          $scope.failed_msg = null;
          return $scope.$apply();
        });
        socket.on('repeated_name_error', function() {
          $scope.failed_msg = "Sorry, " + $scope.name + " was existed. Please choose another name";
          return $scope.$apply();
        });
        socket.on('chatters', function(members) {
          $scope.chatters = members;
          $scope.open_msg_box = true;
          return $scope.$apply();
        });
        socket.on('notice', function(msg_object) {
          $scope.public_msg.push(msg_object);
          return $scope.$apply();
        });
        return socket.emit('join', $scope.name);
      }
    };
  });

}).call(this);
